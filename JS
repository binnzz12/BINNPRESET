/* ===============================
   DEV MODE + TEMPLATE PERSIST
=============================== */
let clickCount = 0;
let clickTimeout;

const logo = document.getElementById("logo");
const devPanel = document.getElementById("devPanel");
const saveEdit = document.getElementById("saveEdit");
const templateWrapper = document.getElementById("templateWrapper");

// Klik logo 5x untuk Dev Mode
logo.onclick = () => {
    clickCount++;
    if (clickCount === 1) clickTimeout = setTimeout(() => clickCount = 0, 2000);
    if (clickCount === 5) {
        clearTimeout(clickTimeout);
        clickCount = 0;
        const key = prompt("Masukkan kunci developer");
        if (btoa(key) === "YmlubnByc3Q=") { // "binnprst"
            localStorage.setItem("DEV", "1");
            document.body.classList.add("dev");
            alert("Developer Mode aktif!");
        } else alert("Akses ditolak");
    }
};

// Jika Dev Mode pernah aktif sebelumnya
if (localStorage.getItem("DEV")) document.body.classList.add("dev");

// Fungsi menyimpan template baru
function saveTemplate(title, videoUrl, presetLink) {
    let templates = JSON.parse(localStorage.getItem("templates") || "[]");
    templates.push({ title, videoUrl, presetLink });
    localStorage.setItem("templates", JSON.stringify(templates));
    renderTemplates();
}

// Fungsi render template dari localStorage
function renderTemplates() {
    let templates = JSON.parse(localStorage.getItem("templates") || "[]");
    templateWrapper.innerHTML = "";
    templates.forEach(t => {
        const div = document.createElement("div");
        div.className = "template";

        const video = document.createElement("video");
        video.src = t.videoUrl;
        video.controls = true;
        div.appendChild(video);

        const titleEl = document.createElement("div");
        titleEl.className = "template-title";
        titleEl.textContent = t.title;
        div.appendChild(titleEl);

        const linkEl = document.createElement("a");
        linkEl.href = t.presetLink;
        linkEl.target = "_blank";
        linkEl.textContent = "Buka Preset";
        div.appendChild(linkEl);

        templateWrapper.appendChild(div);
    });
}

// Load template saat halaman dibuka
window.onload = () => {
    renderTemplates();
};

// Event Dev Panel: tambah template
saveEdit.onclick = () => {
    if (!confirm("Tambahkan template baru?")) return;
    const url = document.getElementById("devVideoUrl").value.trim();
    const title = document.getElementById("devTitle").value.trim();
    const link = document.getElementById("devLink").value.trim();
    if (!url || !title || !link) { alert("Semua kolom harus diisi!"); return; }
    saveTemplate(title, url, link);

    // Reset input
    document.getElementById("devVideoUrl").value = "";
    document.getElementById("devTitle").value = "";
    document.getElementById("devLink").value = "";
};

/* ===============================
   CONTACT FORM WEB3
=============================== */
const web3Form = document.getElementById('web3ContactForm');
const formResponse = document.getElementById('formResponse');

if (web3Form) {
    web3Form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(web3Form);
        try {
            const res = await fetch(web3Form.action, { method: "POST", body: formData });
            const data = await res.json();
            if (data.success) {
                formResponse.textContent = "✅ Pesan berhasil dikirim!";
                formResponse.style.display = "block";
                web3Form.reset();
            } else {
                formResponse.textContent = "❌ Terjadi kesalahan, coba lagi!";
                formResponse.style.display = "block";
            }
        } catch (err) {
            formResponse.textContent = "❌ Network error, cek koneksi!";
            formResponse.style.display = "block";
        }
    });
}
